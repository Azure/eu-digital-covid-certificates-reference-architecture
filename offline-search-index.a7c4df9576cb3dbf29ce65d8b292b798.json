


























[{"body":"Gather the required variables:\nDev # OID of the Group to grant Administrator permissions. This is used to allow access to the deployed AKS cluster for deployments and troubleshooting administrator_group_oid = \"\" # List of network prefixes allowed to SSH to Jumpbox VM jumpbox_ssh_source_address_prefixes = [] # Location Name location = \"\" # Resource Name Prefix. This should be a unique string for each deployment, and is used to ensure that multiple deployments can be done to the same subscription for development and testing prefix = \"\" # Subscription to deploy into subscription_id = \"\" # Tenant to deploy into tenant_id = \"\" EU # ACR Password acr_password = \"\" # ACR Username acr_username = \"\" # OID of the Group to grant Administrator permissions administrator_group_oid = \"\" # Enable the creation of Azure Log Analytics Custer linked to Log Analytics Workspace enable_log_analytics_cluster = false # Enable the creation of azurerm_log_analytics_workspace and azurerm_log_analytics_solution or not enable_log_analytics_workspace = false # Version Number of the Gateway gateway_version = \"79\" # Location Name location = \"\" # Parent DNS Zone Name parent_dns_zone_name = \"\" # Parent DNS Zone Resource Group Name parent_dns_zone_rg_name = \"\" # Resource Name Prefix. This should be a unique string for each deployment, and is used to ensure that multiple deployments can be done to the same subscription for development and testing prefix = \"\" # Subscription to deploy into subscription_id = \"\" # Tenant to deploy into tenant_id = \"\" # Tag of the Utility Image to import utility_image_tag = \"3\" IE # ACR Password acr_password = \"\" # ACR Username acr_username = \"\" # OID of the Group to grant Administrator permissions. This is used to allow access to the jumpboxes for deployments and troubleshooting administrator_group_oid = \"\" # Version Number of the Business Rules Service businessrule_service_version = \"93\" # Enable the creation of Azure Log Analytics Custer linked to Log Analytics Workspace enable_log_analytics_cluster = false # Enable the creation of azurerm_log_analytics_workspace and azurerm_log_analytics_solution or not enable_log_analytics_workspace = false # Version Number of the Issuance Service issuance_service_version = \"94\" # Version Number of the Issuance Web issuance_web_version = \"90\" # Location Name location = \"\" # version of the msal docker image to use msal_proxy_version = \"0.0.1\" # Tag of the Nginx Image to import nginx_image_tag = \"1.21.1\" # Parent DNS Zone Name parent_dns_zone_name = \"\" # Parent DNS Zone Resource Group Name parent_dns_zone_rg_name = \"\" # Resource Name Prefix. This should be a unique string for each deployment, and is used to ensure that multiple deployments can be done to the same subscription for development and testing prefix = \"\" # Subscription to deploy into subscription_id = \"\" # Tenant to deploy into tenant_id = \"\" # Tag of the Utility Image to import utility_image_tag = \"3\" # Version Number of the Verifier Service verifier_service_version = \"95\" ","categories":"","description":"","excerpt":"Gather the required variables:\nDev # OID of the Group to grant …","ref":"/terraform/variables/","tags":"","title":"Installation - Variables"},{"body":"TODO: High Level EU DGC Project Description\nTODO: High Level Azure Ref Arch Project Description\n","categories":"","description":"","excerpt":"TODO: High Level EU DGC Project Description\nTODO: High Level Azure Ref …","ref":"/background/","tags":"","title":"Background"},{"body":"Requirements    Name Version      terraform \u003e= 1.0    azurerm =2.71.0    helm =2.2.0    kubectl =1.11.2    kubernetes =2.4.1    null =3.1.0    random =3.1.0    Providers    Name Version      azurerm =2.71.0    helm =2.2.0    kubectl =1.11.2    kubernetes =2.4.1    null =3.1.0    random =3.1.0    Modules No modules.\nResources    Name Type     azurerm_container_registry.acr resource   azurerm_disk_encryption_set.aks_encryption_set resource   azurerm_dns_ns_record.dns_delegation resource   azurerm_dns_zone.dns resource   azurerm_key_vault.keyvault resource   azurerm_key_vault_key.aks_encryption_key resource   azurerm_key_vault_key.mysql_encryption_key resource   azurerm_key_vault_secret.mysql_pw resource   azurerm_kubernetes_cluster.aks resource   azurerm_log_analytics_cluster.log_analytics_cluster resource   azurerm_log_analytics_linked_service.log_analytics_linked_service resource   azurerm_log_analytics_solution.anti_malware resource   azurerm_log_analytics_solution.azure_activity resource   azurerm_log_analytics_solution.change_tracking resource   azurerm_log_analytics_solution.container_insights resource   azurerm_log_analytics_solution.key_vault_analytics resource   azurerm_log_analytics_solution.network_monitoring resource   azurerm_log_analytics_solution.security_insights resource   azurerm_log_analytics_solution.service_map resource   azurerm_log_analytics_solution.sql_assessment_plus resource   azurerm_log_analytics_solution.updates resource   azurerm_log_analytics_workspace.log_analytics_workspace resource   azurerm_monitor_diagnostic_setting.acr_diagnostic_logs resource   azurerm_monitor_diagnostic_setting.keyvault_diagnostic_logs resource   azurerm_monitor_diagnostic_setting.mysql_diagnostic_logs resource   azurerm_mysql_active_directory_administrator.mysql_aadadmin resource   azurerm_mysql_server.mysql resource   azurerm_mysql_server_key.mysql_encryption_key resource   azurerm_network_security_group.nsg resource   azurerm_network_security_rule.haproxy_ingress_allow_http resource   azurerm_network_security_rule.haproxy_ingress_allow_https resource   azurerm_private_dns_zone.private_dns_zone_acr resource   azurerm_private_dns_zone.private_dns_zone_aks resource   azurerm_private_dns_zone.private_dns_zone_keyvault resource   azurerm_private_dns_zone.private_dns_zone_mysql resource   azurerm_private_dns_zone.private_dns_zone_postgresql resource   azurerm_private_dns_zone_virtual_network_link.private_dns_zone_acr_link resource   azurerm_private_dns_zone_virtual_network_link.private_dns_zone_acr_link_dev resource   azurerm_private_dns_zone_virtual_network_link.private_dns_zone_aks_link resource   azurerm_private_dns_zone_virtual_network_link.private_dns_zone_aks_link_dev resource   azurerm_private_dns_zone_virtual_network_link.private_dns_zone_keyvault_link resource   azurerm_private_dns_zone_virtual_network_link.private_dns_zone_keyvault_link_dev resource   azurerm_private_dns_zone_virtual_network_link.private_dns_zone_mysql_link resource   azurerm_private_dns_zone_virtual_network_link.private_dns_zone_mysql_link_dev resource   azurerm_private_dns_zone_virtual_network_link.private_dns_zone_postgresql_link resource   azurerm_private_dns_zone_virtual_network_link.private_dns_zone_postgresql_link_dev resource   azurerm_private_endpoint.acr_private_endpoint resource   azurerm_private_endpoint.keyvault_private_endpoint resource   azurerm_private_endpoint.mysql_private_endpoint resource   azurerm_public_ip.haproxy_ingress_pip resource   azurerm_resource_group.rg resource   azurerm_resource_group_policy_assignment.aks_acr_policy resource   azurerm_resource_group_policy_assignment.aks_baseline_policy resource   azurerm_role_assignment.aks_acr resource   azurerm_role_assignment.aks_encryption_set resource   azurerm_role_assignment.aks_identity_dns_contributer resource   azurerm_role_assignment.aks_managed_rg_mio resource   azurerm_role_assignment.aks_managed_rg_vmc resource   azurerm_role_assignment.aks_mio resource   azurerm_role_assignment.external_dns_identity_dns_contributor resource   azurerm_role_assignment.keyvault_admin_group_ra resource   azurerm_role_assignment.mysql_kv_role_assignment resource   azurerm_subnet.subnet resource   azurerm_subnet_network_security_group_association.nsg_assoc resource   azurerm_user_assigned_identity.aks_identity resource   azurerm_user_assigned_identity.external_dns_identity resource   azurerm_user_assigned_identity.mysql_aadadmin_identity resource   azurerm_virtual_network.vnet resource   azurerm_virtual_network_peering.from-dev resource   azurerm_virtual_network_peering.to-dev resource   helm_release.aad_pod_identity resource   helm_release.cert_manager resource   helm_release.csi_secrets_store_provider resource   helm_release.external_dns resource   helm_release.haproxy_ingress resource   kubectl_manifest.cert_manager_clusterissuer_letsencrypt resource   kubectl_manifest.external_dns_azure_identity resource   kubectl_manifest.external_dns_azure_identity_binding resource   kubernetes_namespace.aad_pod_identity resource   kubernetes_namespace.cert_manager resource   kubernetes_namespace.external_dns resource   kubernetes_namespace.haproxy_ingress resource   null_resource.aks_delay_before_consent resource   null_resource.import-image resource   null_resource.keyvault_admin_group_ra_delay_before_consent resource   null_resource.mysql_delay_before_consent resource   random_password.mysql_pw resource   azurerm_client_config.current data source   azurerm_resource_group.aks_managed_rg data source    Inputs    Name Description Type Default Required      administrator_group_oid OID of the Group to grant Administrator permissions string n/a yes    dev_vnet_id Dev VNet ID string n/a yes    dev_vnet_name Dev VNet Name string n/a yes    dev_vnet_rg_name Dev VNet RG Name string n/a yes    location Location Name string n/a yes    name Environment Name string n/a yes    parent_dns_zone_name Parent DNS Zone Name string n/a yes    parent_dns_zone_rg_name Parent DNS Zone Resource Group Name string n/a yes    prefix Prefix string n/a yes    aad_pod_identity_chart_version n/a string \"4.1.1\" no    aad_pod_identity_image_tag n/a string \"v1.8.0\" no    aad_pod_identity_immutable_uamis A list of immutable UAMI clien IDs for AAD Pod Identity. These IDs, once added to a node, will not be removed list(any) [] no    acr_imports Map of ACR Imports to perform map(any) {} no    azure_key_vault_provider_image_tag n/a string \"v0.1.0\" no    cert_manager_chart_version n/a string \"1.4.0\" no    cert_manager_image_tag n/a string \"v1.4.0\" no    csi_node_driver_registrar_image_tag n/a string \"v2.2.0\" no    csi_secrets_store_provider_azure_chart_version n/a string \"0.1.0\" no    enable_log_analytics_cluster Enable the creation of Azure Log Analytics Custer linked to Log Analytics Workspace bool false no    enable_log_analytics_workspace Enable the creation of azurerm_log_analytics_workspace and azurerm_log_analytics_solution or not bool false no    external_dns_chart_version n/a string \"5.1.3\" no    external_dns_image_tag n/a string \"0.8.0-debian-10-r26\" no    haproxy_ingress_chart_version n/a string \"v0.13.0-beta.2\" no    haproxy_ingress_image_tag n/a string \"v0.13.0-beta.2\" no    kube_syslog_sidecar_image_digest n/a string \"sha256:f948c128ad982b3676269542da1d9e4339f5553a9fc6831b02edf21a667620d9\" no    kube_syslog_sidecar_image_tag n/a string \"v0.0.1-f948c12\" no    livenessprobe_csi_driver_image_tag n/a string \"v2.3.0\" no    log_analytics_workspace_sku The SKU (pricing level) of the Log Analytics workspace. For new subscriptions the SKU should be set to PerGB2018 string \"PerGB2018\" no    log_retention_in_days The retention period for the logs in days number 30 no    secrets_store_csi_driver_image_tag n/a string \"v0.1.0\" no    secrets_store_driver_crds_image_tag n/a string \"v0.1.0\" no    Outputs    Name Description      acr_login_server n/a    aks_client_certificate n/a    aks_client_key n/a    aks_cluster_ca_certificate n/a    aks_password n/a    aks_private_fqdn n/a    aks_username n/a    dns_zone_name n/a    keyvault_id n/a    keyvault_name n/a    keyvault_uri n/a    mysql_aadadmin_identity_client_id n/a    mysql_aadadmin_identity_id n/a    mysql_aadadmin_identity_name n/a    mysql_server_fqdn n/a    mysql_server_name n/a    private_dns_zone_mysql_id n/a    private_dns_zone_postgresql_id n/a    rg_id n/a    rg_location n/a    rg_name n/a    subnet_id n/a    vnet_id n/a    vnet_name n/a    ","categories":"","description":"","excerpt":"Requirements    Name Version      terraform \u003e= 1.0    azurerm =2.71.0 …","ref":"/terraform/modules/base-infra/","tags":"","title":"Base Infrastructure Terraform Module"},{"body":"Prerequisites  Java JDK. The app has been sucessfully build with JDK 8 and JDK 11, but other later versions should also build the app correctly. We will be also use the keytool from Java JDK to generate the signing certificates for testing. Android SDK required to compress and align the aplication to apk format. Android studio must be started at least once, so it downloads all the additional build tools. Apk signing certificates.  Android Wallet Build Android Wallet app, can be downloaded from TODO, and introduce the URL and the certificates at runtime, but it is also possible to build it. The source code for the wallet app, can be found in the git repository: git@ssh.dev.azure.com:v3/PE-COE/EU-Digital-Green-Certificate/dgca-wallet-app-android. The app, depends on another packages of the same project, which needs to be cloned/downloaded before attempting to run the build. The three repositories, wallet app, and the two depencendies listed below, needs to be placed under the same folder structure.\n app-core-android git@ssh.dev.azure.com:v3/PE-COE/EU-Digital-Green-Certificate/dgca-app-core-android dgc-certlogic-android git@ssh.dev.azure.com:v3/PE-COE/EU-Digital-Green-Certificate/dgc-certlogic-android  Build #Update the paths and versions to your specific platform and installation, MAC os and android SDK have been successfully tested. export ANDROID_SDK_VERSION=\"31.0.0\" export ANDROID_BUILD_TOOLS_PATH=~/\"Library/Android/sdk/build-tools/$ANDROID_SDK_VERSION\" git clone git@ssh.dev.azure.com:v3/PE-COE/EU-Digital-Green-Certificate/dgca-wallet-app-android git clone git@ssh.dev.azure.com:v3/PE-COE/EU-Digital-Green-Certificate/dgca-app-core-android git clone git@ssh.dev.azure.com:v3/PE-COE/EU-Digital-Green-Certificate/dgc-certlogic-android pushd dgca-wallet-app-android ./gradlew --no-daemon build ${ANDROID_BUILD_TOOLS_PATH}/zipalign -v 4 app/build/outputs/apk/acc/release/app-acc-release-unsigned.apk app/build/outputs/apk/acc/release/app-acc-release-zipaligned.apk #Generate the certs to sign the applicaion keytool -genkeypair -alias dgca-wallet-sign-cert -keypass dgca-wallet-sign-cert -keystore dgca-wallet-sign-cert.jks -storepass dgca-wallet-sign-cert #Sign the apk with the certificate created in the pre-requisites. ${ANDROID_BUILD_TOOLS_PATH}/apksigner sign --ks ./dgca-wallet-sign-cert.jks --ks-pass pass:dgca-wallet-sign-cert --ks-key-alias dgca-wallet-sign-cert --key-pass pass:dgca-wallet-sign-cert --verbose ./app/build/outputs/apk/acc/release/app-acc-release-zipaligned.apk popd Android Verifier Build Similarly to the wallet app, it can be downloaded from TODO, in order to build it yourself, you can follow the script below.\n#Update the paths and versions to your specific platform and installation, MAC os and android SDK have been successfully tested. export ANDROID_SDK_VERSION=\"31.0.0\" export ANDROID_BUILD_TOOLS_PATH=~/\"Library/Android/sdk/build-tools/$ANDROID_SDK_VERSION\" git clone git@ssh.dev.azure.com:v3/PE-COE/EU-Digital-Green-Certificate/dgca-verifier-app-android git clone git@ssh.dev.azure.com:v3/PE-COE/EU-Digital-Green-Certificate/dgca-app-core-android git clone git@ssh.dev.azure.com:v3/PE-COE/EU-Digital-Green-Certificate/dgc-certlogic-android pushd dgca-verifier-app-android ./gradlew --no-daemon build ${ANDROID_BUILD_TOOLS_PATH}/zipalign -v 4 app/build/outputs/apk/acc/release/app-acc-release-unsigned.apk app/build/outputs/apk/acc/release/app-acc-release-zipaligned.apk #Generate the certs to sign the applicaion keytool -genkeypair -alias dgca-verifier-sign-cert -keypass dgca-verifier-sign-cert -keystore dgca-verifier-sign-cert.jks -storepass dgca-verifier-sign-cert #Sign the apk with the certificate created in the pre-requisites. ${ANDROID_BUILD_TOOLS_PATH}/apksigner sign --ks ./dgca-verifier-sign-cert.jks --ks-pass pass:dgca-verifier-sign-cert --ks-key-alias dgca-verifier-sign-cert --key-pass pass:dgca-verifier-sign-cert --verbose app/build/outputs/apk/acc/release/app-acc-release-zipaligned.apk ","categories":"","description":"Description of how to build the Android Apps\n","excerpt":"Description of how to build the Android Apps\n","ref":"/android-apps/build/","tags":"","title":"Build"},{"body":"Azure Prerequisites  An active Azure account A subscription available for deployment into, where you have Owner privileges TODO: Any preview features needing to be registered? TODO: DNS Domain Name / Zone resource in Azure? TODO: What do we do with TF State?  ","categories":"","description":"Common prerequisites necessary for all deployment methods\n","excerpt":"Common prerequisites necessary for all deployment methods\n","ref":"/prerequisites/common/","tags":"","title":"Common"},{"body":"Requirements    Name Version      terraform \u003e= 1.0    azurerm =2.71.0    http =2.1.0    kubectl =1.11.2    Providers No providers.\nModules    Name Source Version      eu_dev_jumpbox ../terraform-modules/dev-jumpbox n/a    ie_dev_jumpbox ../terraform-modules/dev-jumpbox n/a    Resources No resources.\nInputs    Name Description Type Default Required      administrator_group_oid OID of the Group to grant Administrator permissions. This is used to allow access to the deployed AKS cluster for deployments and troubleshooting string n/a yes    location Location Name string n/a yes    prefix Resource Name Prefix. This should be a unique string for each deployment, and is used to ensure that multiple deployments can be done to the same subscription for development and testing string n/a yes    subscription_id Subscription to deploy into string n/a yes    tenant_id Tenant to deploy into string n/a yes    jumpbox_ssh_source_address_prefixes List of network prefixes allowed to SSH to Jumpbox VM list(string) [] no    Outputs    Name Description      eu_rg_name n/a    eu_vnet_id n/a    eu_vnet_name n/a    ie_rg_name n/a    ie_vnet_id n/a    ie_vnet_name n/a    ","categories":"","description":"Docs for the development deployment\n","excerpt":"Docs for the development deployment\n","ref":"/terraform/dev/","tags":"","title":"Development Terraform Stack"},{"body":"TODO….\n","categories":"","description":"Deep Dive into Private Link\n","excerpt":"Deep Dive into Private Link\n","ref":"/deep-dives/private-link/","tags":"","title":"Private Link"},{"body":"This repository includes configuration for a DevContainer, allowing for repeatable and reliable usage in VS Code or using GitHub Codespaces.\nThis document describes it’s use within a VS Code. For other options, see here.\nDownload and install Docker Docker is required for running the DevContainer, please follow the Docker installation guidance for your platform.\nDownload and install VS Code Visual Studio Code is Microsoft’s free IDE, it can be downloaded here: Visual Studio code.\nInstall required VS Code extensions The “Remote - Containers” extension is required to use a DevContainer, it is not installed by default. Please follow the installation instructions for installing this extension.\nClone the respository and open in a DevContainer Once the repository has been cloned, VS code will prompt to open the repository in a container, if this would not happen, it can be triggered by the command palete (CMD+Shift+p) and selecting the command ‘Reopen in container’. The first time, vs code automatically will build and run the container locally, attaching the IDE UI to it.\nOnce container has been opened, please go to the deployment page of the docs.\nOpen a Terminal within DevContainer To open a Terminal within the DevContainer, press Ctrl+Shift+P (Cmd+Shift+P on OSX), and begin to type “Terminal”. Choose the “Terminal: Create New Terminal” option and press return.\n","categories":"","description":"Prerequisites necessary for deployment using a VS Code DevContainer\n","excerpt":"Prerequisites necessary for deployment using a VS Code DevContainer\n","ref":"/prerequisites/devcontainer/","tags":"","title":"VS Code DevContainer"},{"body":"EU Digital Green Ceritificates WHY The project is intended to facilitate free movement of EU citizens within EU countries in compliance to a common set of COVID regulations and allowing for some level of per-country customization\nWHO Developed by Deutsche Telekom and SAP and shared as open source for implementation and hosting by all EU member countries\nWHAT The project includes:\n EU Digital Green Cert Gateway Reference workloads for member countries (Certificate Issuing and Verifying services, business rule services) Reference mobile apps (Wallet and Verifier apps)  Base Principles  All End User Identifiable Information is encrypted at rest, with Customer Managed Keys The infrastructure control plane follows best practices and limits access at authorisation, network and application levels Immutable, declaritive configuration and deployment management  ","categories":"","description":"","excerpt":"EU Digital Green Ceritificates WHY The project is intended to …","ref":"/","tags":"","title":"EU Digital Green Certificate - Azure Example Deployment"},{"body":"Requirements    Name Version      terraform \u003e= 1.0    azurerm =2.71.0    helm =2.2.0    kubectl =1.11.2    kubernetes =2.4.1    Providers    Name Version      azurerm 2.71.0    helm 2.2.0    kubernetes 2.4.1    terraform n/a    Modules    Name Source Version      base_infra ../terraform-modules/base-infrastructure n/a    Resources    Name Type     azurerm_key_vault_certificate.trustanchor_certificate resource   azurerm_key_vault_secret.trustanchor_alias resource   azurerm_mysql_database.mysql_db resource   azurerm_role_assignment.dgc_gateway_identity_kv_role_assignment resource   azurerm_user_assigned_identity.dgc_gateway_identity resource   helm_release.dgc_gateway resource   kubernetes_namespace.dgc_gateway resource   terraform_remote_state.dev data source    Inputs    Name Description Type Default Required      acr_password ACR Password string n/a yes    acr_username ACR Username string n/a yes    administrator_group_oid OID of the Group to grant Administrator permissions string n/a yes    location Location Name string n/a yes    parent_dns_zone_name Parent DNS Zone Name string n/a yes    parent_dns_zone_rg_name Parent DNS Zone Resource Group Name string n/a yes    prefix Resource Name Prefix. This should be a unique string for each deployment, and is used to ensure that multiple deployments can be done to the same subscription for development and testing string n/a yes    subscription_id Subscription to deploy into string n/a yes    tenant_id Tenant to deploy into string n/a yes    enable_log_analytics_cluster Enable the creation of Azure Log Analytics Custer linked to Log Analytics Workspace bool false no    enable_log_analytics_workspace Enable the creation of azurerm_log_analytics_workspace and azurerm_log_analytics_solution or not bool false no    gateway_version Version Number of the Gateway string \"79\" no    utility_image_tag Tag of the Utility Image to import string \"3\" no    Outputs    Name Description      dgc_gateway_fqdn The fqdn for the EU DGC Gateway used by the per member country deployments    ","categories":"","description":"Docs for the EU Gateway deployment terraform\n","excerpt":"Docs for the EU Gateway deployment terraform\n","ref":"/terraform/eu/","tags":"","title":"EU Terraform Stack"},{"body":"This repository includes configuration for a DevContainer, allowing for repeatable and reliable usage in GitHub Codespaces or using VS Code DevContainer.\nThis document describes it’s use within a GitHub Codespaces. For other options, see here.\nPrepare GutHub Orginsation To use Codespaces, you must enable codespaces for your organization. Please follow the GitHub documentation, if Codespaces has not already been enabled.\nFork the respository and open in Codespaces Navigate to the Reference Architecture GitHub Repository, and choose the “Fork” button from the upper right hand side of the page \u0026 choose the approperiate organisation.\nOnce the fork has been created - Choose the green “Code” button at the upper left of the page, select the CodeSpaces tab, select “New Codespace” and finally, select the machine type. We recommend the smallest machine type, that is the 2 core \u0026 4GB RAM option.\nGitHub will take several minutes to build the Codespace, once complete, proceed to the section below.\nOpen a Terminal within Codespaces To open a Terminal within the Codespace, press Ctrl+Shift+P (Cmd+Shift+P on OSX), and begin to type “Terminal”. Choose the “Terminal: Create New Terminal” option and press return.\n","categories":"","description":"Prerequisites necessary for deployment using GitHub Codespaces\n","excerpt":"Prerequisites necessary for deployment using GitHub Codespaces\n","ref":"/prerequisites/github-codespaces/","tags":"","title":"GitHub Codespaces"},{"body":"Requirements    Name Version      terraform \u003e= 1.0    azurerm =2.71.0    tls =3.1.0    Providers    Name Version      azurerm =2.71.0    http n/a    tls =3.1.0    Modules No modules.\nResources    Name Type     azurerm_linux_virtual_machine.jumpbox_vm resource   azurerm_network_interface.jumpbox_vm_nic resource   azurerm_network_interface_security_group_association.jumpbox_nsg_association resource   azurerm_network_security_group.jumpbox_nsg resource   azurerm_public_ip.jumpbox_vm_pip resource   azurerm_resource_group.rg resource   azurerm_role_assignment.jumpbox_vm_aad_admins resource   azurerm_role_assignment.jumpbox_vm_aad_users resource   azurerm_subnet.subnet resource   azurerm_virtual_machine_extension.jumpbox_vm_aad resource   azurerm_virtual_network.vnet resource   tls_private_key.jumpbox_vm_ssh resource   azurerm_client_config.current data source   http_http.local_external_ip data source    Inputs    Name Description Type Default Required      administrator_group_oid OID of the Group to grant Administrator permissions string n/a yes    jumpbox_ssh_source_address_prefixes List of prefixes allowed to SSH to Jumpbox VM list(string) n/a yes    location Location Name string n/a yes    name Environment Name string n/a yes    prefix Prefix string n/a yes    Outputs    Name Description      rg_id n/a    rg_location n/a    rg_name n/a    subnet_id n/a    vnet_id n/a    vnet_name n/a    ","categories":"","description":"","excerpt":"Requirements    Name Version      terraform \u003e= 1.0    azurerm =2.71.0 …","ref":"/terraform/modules/jumpbox/","tags":"","title":"Jumpbox Terraform Module"},{"body":"TODO….\n","categories":"","description":"Deep Dive into KeyVault\n","excerpt":"Deep Dive into KeyVault\n","ref":"/deep-dives/keyvault/","tags":"","title":"KeyVault"},{"body":"This document describes manual deployment prerequisites. This deployment method is not recommended. For other options, see here.\nIf you would like to run the deployment on your PC without a container, this is a list of the tools required to complete the deployment. The exact versions of the tools used, where the version is important, can be found in the Dockerfile.\nThe following are needed for a deployment:\n Git Make Azure CLI Azure CLI SSH extension Terraform jq Kubectl Java JDK 11  Once the tooling is installed and the code has been checked out, please proceed to the deployment page of this docs.\n","categories":"","description":"Prerequisites necessary for manual deployment\n","excerpt":"Prerequisites necessary for manual deployment\n","ref":"/prerequisites/manual/","tags":"","title":"Manual"},{"body":"There are several options available to deploy this reference architecture listed below, please ensure you complete the Common prerequisites and one of either VS Code DevContainer, GitHub Codespaces or Manual prerequisites.\nThe VS Code DevContainer or GitHub Codespaces deployment methods are highly recommended over the Manual method.\n","categories":"","description":"","excerpt":"There are several options available to deploy this reference …","ref":"/prerequisites/","tags":"","title":"Prerequisites"},{"body":"","categories":"","description":"","excerpt":"","ref":"/deployment/","tags":"","title":"Deployment"},{"body":"","categories":"","description":"","excerpt":"","ref":"/android-apps/","tags":"","title":"Android Applications"},{"body":"Certificiate Types and Background TODO: An intro to each type of cert used etc, links to the EU DGC repos documentation, etc\n","categories":"","description":"Generate Required Certificates\n","excerpt":"Generate Required Certificates\n","ref":"/deployment/certificates/","tags":"","title":"Certificate Generation"},{"body":"TODO….\n","categories":"","description":"Deep Dive into Customer Managed Keys\n","excerpt":"Deep Dive into Customer Managed Keys\n","ref":"/deep-dives/cmk/","tags":"","title":"Customer Managed Keys"},{"body":"Requirements    Name Version      terraform \u003e= 1.0    azuread =1.6.0    azurerm =2.71.0    helm =2.2.0    kubectl =1.11.2    kubernetes =2.4.1    null =3.1.0    random =3.1.0    Providers    Name Version      azuread 1.6.0    azurerm 2.71.0    helm 2.2.0    kubernetes 2.4.1    null 3.1.0    random 3.1.0    terraform n/a    Modules    Name Source Version      base_infra ../terraform-modules/base-infrastructure n/a    Resources    Name Type     azuread_application.msal_authentication resource   azuread_application_password.msal_authentication resource   azuread_service_principal.msal_authentication resource   azurerm_key_vault_certificate.dsc_key_store_certificate resource   azurerm_key_vault_certificate.tls_key_store_certificate resource   azurerm_key_vault_certificate.upload_key_store_certificate resource   azurerm_key_vault_secret.dsc_key_store_alias resource   azurerm_key_vault_secret.msal_authentication_client_secret resource   azurerm_key_vault_secret.tls_key_store_alias resource   azurerm_key_vault_secret.tls_trust_store_content resource   azurerm_key_vault_secret.tls_trust_store_password resource   azurerm_key_vault_secret.trustanchor_alias resource   azurerm_key_vault_secret.trustanchor_content resource   azurerm_key_vault_secret.trustanchor_password resource   azurerm_key_vault_secret.upload_key_store_alias resource   azurerm_mysql_database.businessrule_service_db resource   azurerm_mysql_database.issuance_service_db resource   azurerm_mysql_database.verifier_service_db resource   azurerm_role_assignment.dgca_businessrule_service_kv_role_assignment resource   azurerm_role_assignment.dgca_issuance_service_kv_role_assignment resource   azurerm_role_assignment.dgca_issuance_service_public_kv_role_assignment resource   azurerm_role_assignment.dgca_verifier_service_kv_role_assignment resource   azurerm_role_assignment.msal_identity_kv_role_assignment resource   azurerm_user_assigned_identity.dgca_businessrule_service_identity resource   azurerm_user_assigned_identity.dgca_issuance_service_identity resource   azurerm_user_assigned_identity.dgca_issuance_service_public_identity resource   azurerm_user_assigned_identity.dgca_issuance_web_identity resource   azurerm_user_assigned_identity.dgca_verifier_service_identity resource   azurerm_user_assigned_identity.msal_authentication resource   helm_release.dgca_businessrule_service resource   helm_release.dgca_issuance_service resource   helm_release.dgca_issuance_service_public resource   helm_release.dgca_issuance_web resource   helm_release.dgca_verifier_service resource   helm_release.msal_authentication resource   kubernetes_namespace.dgca_businessrule_service resource   kubernetes_namespace.dgca_issuance_service resource   kubernetes_namespace.dgca_issuance_service_public resource   kubernetes_namespace.dgca_issuance_web resource   kubernetes_namespace.dgca_verifier_service resource   null_resource.upsert_rules resource   random_uuid.web_auth_oauth2_scope resource   azuread_client_config.current data source   terraform_remote_state.dev data source   terraform_remote_state.eu data source    Inputs    Name Description Type Default Required      acr_password ACR Password string n/a yes    acr_username ACR Username string n/a yes    administrator_group_oid OID of the Group to grant Administrator permissions. This is used to allow access to the jumpboxes for deployments and troubleshooting string n/a yes    location Location Name string n/a yes    parent_dns_zone_name Parent DNS Zone Name string n/a yes    parent_dns_zone_rg_name Parent DNS Zone Resource Group Name string n/a yes    prefix Resource Name Prefix. This should be a unique string for each deployment, and is used to ensure that multiple deployments can be done to the same subscription for development and testing string n/a yes    subscription_id Subscription to deploy into string n/a yes    tenant_id Tenant to deploy into string n/a yes    businessrule_service_version Version Number of the Business Rules Service string \"93\" no    enable_log_analytics_cluster Enable the creation of Azure Log Analytics Custer linked to Log Analytics Workspace bool false no    enable_log_analytics_workspace Enable the creation of azurerm_log_analytics_workspace and azurerm_log_analytics_solution or not bool false no    issuance_service_version Version Number of the Issuance Service string \"94\" no    issuance_web_version Version Number of the Issuance Web string \"90\" no    msal_proxy_version version of the msal docker image to use string \"0.0.1\" no    nginx_image_tag Tag of the Nginx Image to import string \"1.21.1\" no    utility_image_tag Tag of the Utility Image to import string \"3\" no    verifier_service_version Version Number of the Verifier Service string \"95\" no    Outputs    Name Description      businessrule_service_url The url where the business rule backend can be accessed    issuance_service_url The url where the issuance backend can be accessed    issuance_web_address The web address where the issuance website can be accessed    verifier_service_url The url where the verifier service backend can be accessed    ","categories":"","description":"Docs for the EU Gateway deployment terraform\n","excerpt":"Docs for the EU Gateway deployment terraform\n","ref":"/terraform/ie/","tags":"","title":"Ireland Terraform Stack"},{"body":"TODO….\n","categories":"","description":"Deep Dive into AAD authentication for MySQL\n","excerpt":"Deep Dive into AAD authentication for MySQL\n","ref":"/deep-dives/aad-mysql/","tags":"","title":"AAD authentication for MySQL"},{"body":"","categories":"","description":"","excerpt":"","ref":"/deep-dives/","tags":"","title":"Deep Dives"},{"body":"TODO….\n","categories":"","description":"Deep Dive into AAD authentication for Azure Kubernetes Service\n","excerpt":"Deep Dive into AAD authentication for Azure Kubernetes Service\n","ref":"/deep-dives/aad-aks/","tags":"","title":"AAD authentication for Azure Kubernetes Service"},{"body":"Set Variables Create a terraform.tfvars at the root of the repo that contains:\nprefix = \"\u003cprefix\u003e\" subscription_id = \"\u003cid\u003e\" tenant_id = \"\u003cid\u003e\" jumpbox_ssh_source_address_prefixes = [] acr_username = \"apecoeacr\" acr_password = \"\u003cADMIN PW FETCHED FROM APECOE ACR in DEV1 SUB\u003e\" administrator_group_oid = \"\u003cid\u003e\" location = \"northeurope\" parent_dns_zone_name = \"dns name\" parent_dns_zone_rg_name = \"\u003cid\u003e\" enable_log_analytics_workspace = false enable_log_analytics_cluster = false Where:\n prefix is set as a unique identifier (please avoid spaces or special characters). This is used to create names and identifiers of the different resources, so multiple deployments can be done on the same subscription. jumpbox_ssh_source_address_prefixes is set as the public IP address(es) from which you are connecting to Azure (run curl icanhazip.com to find your public IP). tenant_id is the id of the tenant owning the subcription where the deployment will be made. subscription_id the id of the subcription where the deployment wil be made. jumpbox_ssh_source_address_prefixes Additional allowed ip / network prefixes allowed to connect to the jump boxes. We will automatically add the external IP address of the machine running the deployment. These should be in a comma separated list, using network prefix format like : [\"10.0.0.0/8\",\"192.168.100.25/32\"] acr_username the username of the ACR (Azure containter registry) where the images will be pulled from. acr_password password for the ACR. administrator_group_oid Object id of the AAD group that will get adminstrator access. location The az region (short name) where the deployment will be made. parent_dns_zone_name The name of the domain created for the deployment in the prerequisites section. parent_dns_zone_rg_name The resource group where the DNS zone has been created. enable_log_analytics_workspace Enable Azure Log Analytics Workspace, disabled by default. enable_log_analytics_cluster Enable Azure Log Analytics cluster, disabled by default. enable_log_analytics_workspace is also required if you wish Log Analytics cluster to be enabled. Also advised to looking into your Azure Subcription’s Qoutas before enabling.  All In One Deployment Once the variables file has been created, the process of creating the infrastructure and deploying the application has been automated though terraform and scripts. Before initialing the deployment, Azure cli (az) must be logged in, you can log in by running az login. After logged, the process can be started by running make on the base directory of the project. This will create the required certificates and start the terraform deployment of the different components described in the step by step process.\nStep by Step Deployment This section describes how to apply each step manually instead of gettin invoked by the main make.\nStep by Step - Terraform workspaces Deployment is done via terraform, which supports workspaces for isolation between different deployments of the same infrastructure. In this case, we use the variable defined in prefix to create different terraform workspaces, so multiple users can perform a deployment in the same subscription. Running make workspace will go to the different terraform stacks and adjust the namespace.\nStep by Step - Tools Some dgc specific signatures are required for the certificate generation in the next step, tools target in main Makefile, downloads the gdc-cli binary (jar) in the tools folder. There’s also a Makefile in the tools folder that can be invoked directly.\nStep by Step - Certificates As describes in certificates doc section, project relies on certificates to ensure security as well as the green digitcal certificate itself. The process of generating the certificates has been automated in an script, it can be invoked with the required arguments/variables by make certs command.\nStep by Step - Jumpboxes For security, none of the services used in this deployment, uses public endpoints (except of course the load balances), this prevents anyy public IP reaching the Databases or Key vault. This means that before connecting Kubernetes cluster (AKS) to perform deployments, we need to connect to jumphosts that have private connectivity to the services.\nThis step is performed by moving to the eudgc-dev and executing make. The first part of this make target will create the infrastructure for the jumpboxes using terraform, once the VMs are ready, it will create ssh configuration files (in eudgc-dev/jumpbox-ssh-configs folder) to facilitate the access to it as well as stablishing the required tunnels to reach AKS clusters.\nStep by Step - EU Infrastructure Each country service, relies on the “central” european gategway. The folder eudgc-eu contains the folder with the infrastructre and deployment of the gateway. The default make target (all), will first stanlish the required ssh tunnels to start the proxy in the VNET where the deployment will be made, enabling the deployment of the application after the AKS cluster is up and running.\nStep by Step - IE Infrastructure The main applications of this deployment are the validation and rules services, that are deployed by each country and the mobile apps will contact to. Those services, as well as the EU are deployed into a kubernetes (AKS) cluster, applying the same security principles, only the HTTPS services being exposed. All the infrastructre and deployment is done via terraform, in the folder eudgc-ie.\n","categories":"","description":"Deploy the EU Digital Green Certificate Reference Architecture\n","excerpt":"Deploy the EU Digital Green Certificate Reference Architecture\n","ref":"/deployment/deployment/","tags":"","title":"Deployment"},{"body":"Issue a Certificate TODO: Descibe how to access the Issuance Web site and how to issue a Vaccine Cert.\nSSH to EU Jumpboxes During the creation of the eudgc-dev terraform stack, VNets and Jumpboxes are created as jumphosts to access the AKS cluster securely. Once the infrastructure has been deployed, the process generates SSH configuration files to simplify the access to the jumphosts in the folder eudgc-dev/jumpbox-ssh-configs. The creation of config files (in case keys are changed externally/manually), can be regenerated by the make target make ssh-config, will write the files in the folder mentioned above.\nIn order to start an interactive ssh to any of the two zones (eu or ie) we can use the ssh config files. The command can be automatically generated by issuing make print-ssh-cmd which will output the ssh command to connect to VMs. This target is the root directory as well as eudgc-eu and eudgc-ie\nAccess AKS The simplest way to access the private interface in the AKS cluster from your computer is through a SOCKS5 tunnel, this is compatible with the CLI tooling required to operate a Kubernetes cluster. SSH has builtin capabilities to create this types of proxies in the local network and send the traffic through the ssh tunnel. Two convenience make targets ssh-tunnel-start and ssh-tunnel-stop are available, once tunnels are started, exporting the following variables will make the CLI tooling to use the proxy.\nexport ALL_PROXY=socks5h://127.0.0.1:8881 export HTTPS_PROXY=socks5://127.0.0.1:8881 export HTTP_PROXY=socks5://127.0.0.1:8881 Use port 8881 for EU and 8882 for IE deployments.\n","categories":"","description":"Validation the deployment of the EU Digital Green Certificate Reference Architecture\n","excerpt":"Validation the deployment of the EU Digital Green Certificate …","ref":"/deployment/validation/","tags":"","title":"Validation"},{"body":"As the base infrastructures for the stacks are very similar, we have abstracted them into modules.\n","categories":"","description":"","excerpt":"As the base infrastructures for the stacks are very similar, we have …","ref":"/terraform/modules/","tags":"","title":"Terraform Modules"},{"body":"","categories":"","description":"","excerpt":"","ref":"/terraform/","tags":"","title":"Terraform Docs (Autogenerated)"}]